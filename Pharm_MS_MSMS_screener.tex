\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Screening of pharamceuticals in wastewater samples from direct injection-HRMS single spectra files},
            pdfauthor={Ingus Perkons},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Screening of pharamceuticals in wastewater samples from direct
injection-HRMS single spectra files}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Ingus Perkons}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{July 15, 2020}


\begin{document}
\maketitle

\section{Load packages}\label{load-packages}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{require}\NormalTok{(readxl)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: readxl
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{require}\NormalTok{(dplyr,}\DataTypeTok{warn.conflicts =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: dplyr
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{require}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: ggplot2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{require}\NormalTok{(stringr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: stringr
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{require}\NormalTok{(ggpmisc)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: ggpmisc
\end{verbatim}

Set working directory to source file location \emph{(In RStudio: Session
-\textgreater{} Set Working Directory -\textgreater{} To Source File
Location)}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#setwd(dirname(rstudioapi::getActiveDocumentContext()$path))}
\end{Highlighting}
\end{Shaded}

Initialize MS1 and MS2 databases and define the name of the sample. The
database file must be placed in ``\textasciitilde{}Database/'' folder!
Do not edit the column names of the database.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Target.database <-}\StringTok{ }\KeywordTok{read_xlsx}\NormalTok{(}\DataTypeTok{path =} \StringTok{"Database/Database_pharmaceuticals_environment.xlsx"}\NormalTok{, }\DataTypeTok{sheet =} \DecValTok{2}\NormalTok{)}
\NormalTok{Suspect.database <-}\StringTok{ }\KeywordTok{read_xlsx}\NormalTok{(}\DataTypeTok{path =} \StringTok{"Database/Database_pharmaceuticals_environment.xlsx"}\NormalTok{, }\DataTypeTok{sheet =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\emph{Sample name must be typed manually.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Sample.name <-}\StringTok{ "Example_sample"}
\end{Highlighting}
\end{Shaded}

Check if the folders for Sample.name already exist. Folders will be
created automatically in accordance to the given value in
\textbf{Sample.name} variable

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dir.exists}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{) }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{) \{}\KeywordTok{dir.create}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{)\}}
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dir.exists}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{)) }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{) \{}\KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{))\}}
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dir.exists}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/MS1_spectra/"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{)) }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{) \{}\KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/MS1_spectra/"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{))\}}
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dir.exists}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/MS2_spectra_suspect/"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{)) }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{) \{}\KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/MS2_spectra_suspect/"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{))\}}
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dir.exists}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/MS2_spectra_suspect/"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{)) }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{) \{}\KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/MS2_spectra_target/"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{))\}}
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dir.exists}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/Precursor lists/"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{)) }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{) \{}\KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/Precursor lists/"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{))\}}
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dir.exists}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/Results/"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{)) }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{) \{}\KeywordTok{dir.create}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/Results/"}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{))\}}
\end{Highlighting}
\end{Shaded}

\section{Activate custom-made
functions}\label{activate-custom-made-functions}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Spectra.find <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(Spectra, Q1, Q2, Ratio, Mass.error.threshold) \{}
  \KeywordTok{colnames}\NormalTok{(Spectra) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"V1"}\NormalTok{,}\StringTok{"V2"}\NormalTok{)}
\NormalTok{  Error.}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\NormalTok{Q1}\OperatorTok{*}\NormalTok{(Mass.error.threshold}\OperatorTok{/}\DecValTok{1000000}\NormalTok{) }
\NormalTok{  mz.}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\NormalTok{Spectra }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{((V1 }\OperatorTok{>}\StringTok{ }\NormalTok{Q1}\OperatorTok{-}\NormalTok{Error.}\DecValTok{1}\NormalTok{) }\OperatorTok{&}\StringTok{ }\NormalTok{(V1 }\OperatorTok{<}\StringTok{ }\NormalTok{Q1}\OperatorTok{+}\NormalTok{Error.}\DecValTok{1}\NormalTok{))}
\NormalTok{  Error.}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{Q2}\OperatorTok{*}\NormalTok{(Mass.error.threshold}\OperatorTok{/}\DecValTok{1000000}\NormalTok{) }
\NormalTok{  mz.}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{Spectra }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{((V1 }\OperatorTok{>}\StringTok{ }\NormalTok{Q2}\OperatorTok{-}\NormalTok{Error.}\DecValTok{2}\NormalTok{) }\OperatorTok{&}\StringTok{ }\NormalTok{(V1 }\OperatorTok{<}\StringTok{ }\NormalTok{Q2}\OperatorTok{+}\NormalTok{Error.}\DecValTok{2}\NormalTok{))}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dim}\NormalTok{(mz.}\DecValTok{2}\NormalTok{)[}\DecValTok{1}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{) \{mz.}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{V1 =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{V2 =} \OtherTok{NA}\NormalTok{)\}}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dim}\NormalTok{(mz.}\DecValTok{1}\NormalTok{)[}\DecValTok{1}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{) \{}
\NormalTok{    mz.}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{V1 =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{V2 =} \OtherTok{NA}\NormalTok{)}
\NormalTok{    mz.}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{V1 =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{V2 =} \OtherTok{NA}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dim}\NormalTok{(mz.}\DecValTok{2}\NormalTok{)[}\DecValTok{1}\NormalTok{] }\OperatorTok{>}\StringTok{ }\DecValTok{1}\NormalTok{) \{mz.}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{(mz.}\DecValTok{2} \OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Error =} \KeywordTok{abs}\NormalTok{(V1}\OperatorTok{-}\NormalTok{Q2)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(Error }\OperatorTok{==}\StringTok{ }\KeywordTok{min}\NormalTok{(Error)))[,}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{)]\}}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dim}\NormalTok{(mz.}\DecValTok{1}\NormalTok{)[}\DecValTok{1}\NormalTok{] }\OperatorTok{>}\StringTok{ }\DecValTok{1}\NormalTok{) \{mz.}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\NormalTok{(mz.}\DecValTok{1} \OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Error =} \KeywordTok{abs}\NormalTok{(V1}\OperatorTok{-}\NormalTok{Q1)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(Error }\OperatorTok{==}\StringTok{ }\KeywordTok{min}\NormalTok{(Error)))[,}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{)]\}}
\NormalTok{  Ratio.exp <-}\StringTok{ }\NormalTok{(mz.}\DecValTok{2}\OperatorTok{$}\NormalTok{V2 }\OperatorTok{/}\StringTok{ }\NormalTok{mz.}\DecValTok{1}\OperatorTok{$}\NormalTok{V2)}\OperatorTok{*}\DecValTok{100}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{is.na}\NormalTok{(mz.}\DecValTok{1}\OperatorTok{$}\NormalTok{V1)}\OperatorTok{==}\OtherTok{FALSE}\NormalTok{) \{Error.}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\NormalTok{(mz.}\DecValTok{1}\OperatorTok{$}\NormalTok{V1}\OperatorTok{-}\NormalTok{Q1)}\OperatorTok{/}\NormalTok{Q1}\OperatorTok{*}\DecValTok{1000000}\NormalTok{ \} }\ControlFlowTok{else}\NormalTok{ \{Error.}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\OtherTok{NA}\NormalTok{\}}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{is.na}\NormalTok{(mz.}\DecValTok{2}\OperatorTok{$}\NormalTok{V1)}\OperatorTok{==}\OtherTok{FALSE}\NormalTok{) \{Error.}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{(mz.}\DecValTok{2}\OperatorTok{$}\NormalTok{V1}\OperatorTok{-}\NormalTok{Q2)}\OperatorTok{/}\NormalTok{Q2}\OperatorTok{*}\DecValTok{1000000}\NormalTok{ \} }\ControlFlowTok{else}\NormalTok{ \{Error.}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\OtherTok{NA}\NormalTok{\}}
\NormalTok{  Ratio.error <-}\StringTok{ }\NormalTok{(Ratio.exp}\OperatorTok{-}\NormalTok{Ratio)}\OperatorTok{/}\NormalTok{Ratio}\OperatorTok{*}\DecValTok{100}
\NormalTok{  Ratio.error.abs <-}\StringTok{ }\NormalTok{Ratio.exp}\OperatorTok{-}\NormalTok{Ratio}
  \KeywordTok{return}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{round}\NormalTok{(mz.}\DecValTok{1}\OperatorTok{$}\NormalTok{V2,}\DecValTok{0}\NormalTok{)),}
           \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{round}\NormalTok{(Error.}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{)),}
           \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{round}\NormalTok{(Error.}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)),}
           \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{round}\NormalTok{(Ratio.exp,}\DecValTok{2}\NormalTok{)),}
           \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{round}\NormalTok{(Ratio.error,}\DecValTok{2}\NormalTok{)),}
           \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{round}\NormalTok{(Ratio.error.abs,}\DecValTok{2}\NormalTok{))))}
\NormalTok{\}}

\NormalTok{MS2.match <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(Spectra, Fragment,Mass.error.threshold) \{}
\NormalTok{  Error.}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\NormalTok{Fragment}\OperatorTok{*}\NormalTok{(Mass.error.threshold}\OperatorTok{/}\DecValTok{1000000}\NormalTok{) }
\NormalTok{  mz.}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\NormalTok{Spectra }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{((V1 }\OperatorTok{>}\StringTok{ }\NormalTok{Fragment}\OperatorTok{-}\NormalTok{Error.}\DecValTok{1}\NormalTok{) }\OperatorTok{&}\StringTok{ }\NormalTok{(V1 }\OperatorTok{<}\StringTok{ }\NormalTok{Fragment}\OperatorTok{+}\NormalTok{Error.}\DecValTok{1}\NormalTok{))}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dim}\NormalTok{(mz.}\DecValTok{1}\NormalTok{)[}\DecValTok{1}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{) \{}
    \KeywordTok{return}\NormalTok{(}\OtherTok{FALSE}\NormalTok{) \} }\ControlFlowTok{else}\NormalTok{ \{}
      \KeywordTok{return}\NormalTok{(}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{\}}

\NormalTok{Consolidate_MS2_results <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(MSMS_sheet, Storage_sheet) \{}
  
\NormalTok{  \{MSMS_sheet <-}\StringTok{ }\NormalTok{MSMS_sheet }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{group_by}\NormalTok{(Name,Polarity,CE.level) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Fragments.found =} \KeywordTok{sum}\NormalTok{(Status.found, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }\DataTypeTok{Fragments.not.found =} \KeywordTok{sum}\NormalTok{(Status.found }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{select}\NormalTok{(Name,Polarity,CE.level,Fragments.found,Fragments.not.found) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{unique}\NormalTok{(.) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{group_by}\NormalTok{(Name,Polarity) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{MS2.found =} \KeywordTok{max}\NormalTok{(Fragments.found, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{),}
           \DataTypeTok{MS2.fragments.in.db =}\NormalTok{ (}\KeywordTok{sum}\NormalTok{(Fragments.not.found, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)}\OperatorTok{+}\KeywordTok{sum}\NormalTok{(Fragments.found, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{))}\OperatorTok{/}\DecValTok{3}\NormalTok{,}
           \DataTypeTok{MS2.CE.level =}\NormalTok{ (CE.level[Fragments.found }\OperatorTok{==}\StringTok{ }\KeywordTok{max}\NormalTok{(Fragments.found, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)])[}\DecValTok{1}\NormalTok{],}
           \DataTypeTok{Status =} \KeywordTok{ifelse}\NormalTok{(MS2.found }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{, }\OtherTok{FALSE}\NormalTok{, }\OtherTok{TRUE}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{select}\NormalTok{(Name, Polarity, MS2.found,MS2.CE.level,MS2.fragments.in.db,Status) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{unique}\NormalTok{(.)\}}
  
\NormalTok{  Storage_sheet}\OperatorTok{$}\NormalTok{MS2.found <-}\StringTok{ }\OtherTok{NA}
\NormalTok{  Storage_sheet}\OperatorTok{$}\NormalTok{MS2.CE.level <-}\StringTok{ }\OtherTok{NA}
\NormalTok{  Storage_sheet}\OperatorTok{$}\NormalTok{MS2.fragments.in.db <-}\StringTok{ }\OtherTok{NA}
\NormalTok{  Storage_sheet}\OperatorTok{$}\NormalTok{MS2.Status <-}\StringTok{ }\OtherTok{NA}
  
  
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{dim}\NormalTok{(Storage_sheet)[}\DecValTok{1}\NormalTok{]) \{}
\NormalTok{    Storage_sheet}\OperatorTok{$}\NormalTok{MS2.found[i] <-}\StringTok{ }\KeywordTok{unname}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(MSMS_sheet }\OperatorTok{%>%}
\StringTok{                                                  }\KeywordTok{filter}\NormalTok{(Name }\OperatorTok{==}\StringTok{ }\NormalTok{Storage_sheet}\OperatorTok{$}\NormalTok{Name[i]) }\OperatorTok{%>%}
\StringTok{                                                  }\KeywordTok{filter}\NormalTok{(Polarity }\OperatorTok{==}\StringTok{ }\NormalTok{Storage_sheet}\OperatorTok{$}\NormalTok{Charge[i]))[}\DecValTok{3}\NormalTok{]) }
\NormalTok{    Storage_sheet}\OperatorTok{$}\NormalTok{MS2.CE.level[i] <-}\StringTok{ }\KeywordTok{unname}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(MSMS_sheet }\OperatorTok{%>%}
\StringTok{                                                     }\KeywordTok{filter}\NormalTok{(Name }\OperatorTok{==}\StringTok{ }\NormalTok{Storage_sheet}\OperatorTok{$}\NormalTok{Name[i]) }\OperatorTok{%>%}
\StringTok{                                                     }\KeywordTok{filter}\NormalTok{(Polarity }\OperatorTok{==}\StringTok{ }\NormalTok{Storage_sheet}\OperatorTok{$}\NormalTok{Charge[i]))[}\DecValTok{4}\NormalTok{]) }
\NormalTok{    Storage_sheet}\OperatorTok{$}\NormalTok{MS2.fragments.in.db[i] <-}\StringTok{ }\KeywordTok{unname}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(MSMS_sheet }\OperatorTok{%>%}
\StringTok{                                                            }\KeywordTok{filter}\NormalTok{(Name }\OperatorTok{==}\StringTok{ }\NormalTok{Storage_sheet}\OperatorTok{$}\NormalTok{Name[i]) }\OperatorTok{%>%}
\StringTok{                                                            }\KeywordTok{filter}\NormalTok{(Polarity }\OperatorTok{==}\StringTok{ }\NormalTok{Storage_sheet}\OperatorTok{$}\NormalTok{Charge[i]))[}\DecValTok{5}\NormalTok{]) }
\NormalTok{    Storage_sheet}\OperatorTok{$}\NormalTok{MS2.Status[i] <-}\StringTok{ }\KeywordTok{unname}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(MSMS_sheet }\OperatorTok{%>%}
\StringTok{                                                   }\KeywordTok{filter}\NormalTok{(Name }\OperatorTok{==}\StringTok{ }\NormalTok{Storage_sheet}\OperatorTok{$}\NormalTok{Name[i]) }\OperatorTok{%>%}
\StringTok{                                                   }\KeywordTok{filter}\NormalTok{(Polarity }\OperatorTok{==}\StringTok{ }\NormalTok{Storage_sheet}\OperatorTok{$}\NormalTok{Charge[i]))[}\DecValTok{6}\NormalTok{])  }
    
\NormalTok{  \} }
  \KeywordTok{return}\NormalTok{(Storage_sheet)}
\NormalTok{\}}

\NormalTok{MS2.screener <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(Precursor.list,MS2.peaklist,Sample.name,Type,Template,MS2.ref.spectra.type) \{}
  \ControlFlowTok{if}\NormalTok{ (Type }\OperatorTok{==}\StringTok{ "Target"}\NormalTok{) \{ Type <-}\StringTok{"MS2_spectra_target"}\NormalTok{\}}
  \ControlFlowTok{if}\NormalTok{ (Type }\OperatorTok{==}\StringTok{ "Suspect"}\NormalTok{) \{ Type <-}\StringTok{"MS2_spectra_suspect"}\NormalTok{\}}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{dim}\NormalTok{(Precursor.list)[}\DecValTok{1}\NormalTok{]) \{}
\NormalTok{    spectra.MS2 <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/"}\NormalTok{,Type,}\StringTok{"/"}\NormalTok{,Precursor.list}\OperatorTok{$}\NormalTok{File.name[i],}\DataTypeTok{sep =} \StringTok{""}\NormalTok{),}\DataTypeTok{sep =} \StringTok{","}\NormalTok{,}\DataTypeTok{header =}\NormalTok{ T)}
    \KeywordTok{colnames}\NormalTok{(spectra.MS2) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"V1"}\NormalTok{,}\StringTok{"V2"}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{ (MS2.ref.spectra.type }\OperatorTok{==}\StringTok{ "Experimental"}\NormalTok{) \{}
\NormalTok{    MS2.fragments <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(}
      \KeywordTok{str_split}\NormalTok{(}
\NormalTok{        (MS2.peaklist[}\KeywordTok{which}\NormalTok{(MS2.peaklist}\OperatorTok{$}\NormalTok{Name }\OperatorTok{%in%}\StringTok{ }\NormalTok{Precursor.list}\OperatorTok{$}\NormalTok{Name[i]),] }\OperatorTok{%>%}
\StringTok{           }\KeywordTok{filter}\NormalTok{(Polarity }\OperatorTok{==}\StringTok{ }\NormalTok{Precursor.list}\OperatorTok{$}\NormalTok{Charge[i]))}\OperatorTok{$}\StringTok{`}\DataTypeTok{MS2 fingerprint (experimental), m/z}\StringTok{`}\NormalTok{[}\DecValTok{1}\NormalTok{],}\DataTypeTok{pattern =} \StringTok{";"}\NormalTok{))\}}
    \ControlFlowTok{if}\NormalTok{ (MS2.ref.spectra.type }\OperatorTok{==}\StringTok{ "In-silico"}\NormalTok{) \{}
\NormalTok{      MS2.fragments <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(}
        \KeywordTok{str_split}\NormalTok{(}
\NormalTok{          (MS2.peaklist[}\KeywordTok{which}\NormalTok{(MS2.peaklist}\OperatorTok{$}\NormalTok{Name }\OperatorTok{%in%}\StringTok{ }\NormalTok{Precursor.list}\OperatorTok{$}\NormalTok{Name[i]),] }\OperatorTok{%>%}
\StringTok{             }\KeywordTok{filter}\NormalTok{(Polarity }\OperatorTok{==}\StringTok{ }\NormalTok{Precursor.list}\OperatorTok{$}\NormalTok{Charge[i]))}\OperatorTok{$}\StringTok{`}\DataTypeTok{MS2 fingerprint (predicted), m/z}\StringTok{`}\NormalTok{[}\DecValTok{1}\NormalTok{],}\DataTypeTok{pattern =} \StringTok{";"}\NormalTok{))\}}

    
    \ControlFlowTok{for}\NormalTok{ (g }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(MS2.fragments)) \{}
\NormalTok{      Template <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(Template,}
                        \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{Name =} \KeywordTok{as.character}\NormalTok{(Precursor.list}\OperatorTok{$}\NormalTok{Name[i]),}
                                   \DataTypeTok{Polarity =} \KeywordTok{as.numeric}\NormalTok{(Precursor.list}\OperatorTok{$}\NormalTok{Charge[i]),}
                                   \DataTypeTok{Fragment =} \KeywordTok{as.numeric}\NormalTok{(MS2.fragments[g]),}
                                   \DataTypeTok{Status.found =} \KeywordTok{MS2.match}\NormalTok{(spectra.MS2,}\KeywordTok{as.numeric}\NormalTok{(MS2.fragments[g]),}\DataTypeTok{Mass.error.threshold =} \FloatTok{2.5}\NormalTok{),}
                                   \DataTypeTok{CE.level =} \KeywordTok{as.character}\NormalTok{(Precursor.list}\OperatorTok{$}\NormalTok{CE.level[i]),}
                                   \DataTypeTok{File.name =}\NormalTok{ Precursor.list}\OperatorTok{$}\NormalTok{File.name[i], }\DataTypeTok{stringsAsFactors =} \OtherTok{FALSE}\NormalTok{))}
      
\NormalTok{    \}\}  }
  \KeywordTok{return}\NormalTok{(Template)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Sample measurement}\label{sample-measurement}

Measure the sample to obtain two full MS spectra (in both polarities).
Export the spectra as CSV files. Filename for negative mode:
Sample.name-NEG.csv, filename for positive mode: Sample.name-POS.csv.

Store both spectra in the main directory under
\textasciitilde{}/Samples/\textbf{Sample\_name}/MS1\_spectra/. CSV files
have to contain two columns (m/z values and m/z signal intensities):

\begin{longtable}[]{@{}ll@{}}
\toprule
Column 1 (m/z) & Column 2 (signal intensity, counts)\tabularnewline
\midrule
\endhead
294.0068 & 121821\tabularnewline
296.0063 & 29324\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Target screening}\label{target-screening}

Load full MS data files for the sample.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Spectra.list <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{spectra.pos =} \KeywordTok{read.csv}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/MS1_spectra/"}\NormalTok{,Sample.name,}\StringTok{"-POS.csv"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{""}\NormalTok{),}\DataTypeTok{sep =} \StringTok{","}\NormalTok{,}\DataTypeTok{header =}\NormalTok{ T),}
                     \DataTypeTok{spectra.neg =} \KeywordTok{read.csv}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/MS1_spectra/"}\NormalTok{,Sample.name,}\StringTok{"-NEG.csv"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{""}\NormalTok{),}\DataTypeTok{sep =} \StringTok{","}\NormalTok{,}\DataTypeTok{header =}\NormalTok{ T))}
\end{Highlighting}
\end{Shaded}

Create data frame for target results.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Results.target <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{Name =} \KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                            \DataTypeTok{MolecularFormula =} \KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                            \DataTypeTok{Q1 =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                            \DataTypeTok{Ratio.theoretical =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                            \DataTypeTok{Charge =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                            \DataTypeTok{Intensity =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                            \DataTypeTok{Error.Q1 =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                            \DataTypeTok{Error.Q2 =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                            \DataTypeTok{Ratio.experimental =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                            \DataTypeTok{Ratio.error.rel =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                            \DataTypeTok{Ratio.error.abs =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{), }\DataTypeTok{stringsAsFactors =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Perform full MS target screening.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{dim}\NormalTok{(Target.database)[}\DecValTok{1}\NormalTok{]) \{}
\ControlFlowTok{if}\NormalTok{ (Target.database}\OperatorTok{$}\NormalTok{Polarity[i] }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) \{MS1.data <-}\StringTok{ }\NormalTok{Spectra.list}\OperatorTok{$}\NormalTok{spectra.pos\} }\ControlFlowTok{else}\NormalTok{ \{MS1.data <-}\StringTok{ }\NormalTok{Spectra.list}\OperatorTok{$}\NormalTok{spectra.neg\}}
\NormalTok{  Results.target <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(Results.target, }\KeywordTok{c}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(Target.database}\OperatorTok{$}\NormalTok{Name[i]),}
                                            \KeywordTok{as.character}\NormalTok{(Target.database}\OperatorTok{$}\NormalTok{MolecularFormula[i]),}
                                            \KeywordTok{as.numeric}\NormalTok{(Target.database}\OperatorTok{$}\StringTok{`}\DataTypeTok{Q1, m/z}\StringTok{`}\NormalTok{[i]),}
                                            \KeywordTok{as.numeric}\NormalTok{(Target.database}\OperatorTok{$}\StringTok{`}\DataTypeTok{Ratio Q2/Q1}\StringTok{`}\NormalTok{[i]),}
                                            \KeywordTok{as.numeric}\NormalTok{(Target.database}\OperatorTok{$}\NormalTok{Polarity[i]),}
                                            \KeywordTok{Spectra.find}\NormalTok{(MS1.data,Target.database}\OperatorTok{$}\StringTok{`}\DataTypeTok{Q1, m/z}\StringTok{`}\NormalTok{[i],}
\NormalTok{                                                         Target.database}\OperatorTok{$}\StringTok{`}\DataTypeTok{Q2, m/z}\StringTok{`}\NormalTok{[i],}
\NormalTok{                                                         Target.database}\OperatorTok{$}\StringTok{`}\DataTypeTok{Ratio Q2/Q1}\StringTok{`}\NormalTok{[i],}
                                                         \DataTypeTok{Mass.error.threshold =} \FloatTok{1.25}\NormalTok{)))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Suspect screening}\label{suspect-screening}

Create data frame for suspect screening results.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Results.suspect <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{Name =} \KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                             \DataTypeTok{MolecularFormula =} \KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                             \DataTypeTok{Q1 =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                             \DataTypeTok{Ratio.theoretical =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                             \DataTypeTok{Charge =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                             \DataTypeTok{Intensity =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                             \DataTypeTok{Error.Q1 =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                             \DataTypeTok{Error.Q2 =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                             \DataTypeTok{Ratio.experimental =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                             \DataTypeTok{Ratio.error.rel =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                             \DataTypeTok{Ratio.error.abs =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{), }\DataTypeTok{stringsAsFactors =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Perform full MS suspect screening.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{dim}\NormalTok{(Suspect.database)[}\DecValTok{1}\NormalTok{]) \{}
  \ControlFlowTok{if}\NormalTok{ (Suspect.database}\OperatorTok{$}\NormalTok{Polarity[i] }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) \{MS1.data <-}\StringTok{ }\NormalTok{Spectra.list}\OperatorTok{$}\NormalTok{spectra.pos\} }\ControlFlowTok{else}\NormalTok{ \{MS1.data <-}\StringTok{ }\NormalTok{Spectra.list}\OperatorTok{$}\NormalTok{spectra.neg\}}
\NormalTok{  Results.suspect <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(Results.suspect, }\KeywordTok{c}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(Suspect.database}\OperatorTok{$}\NormalTok{Name[i]),}
                                            \KeywordTok{as.character}\NormalTok{(Suspect.database}\OperatorTok{$}\NormalTok{MolecularFormula[i]),}
                                            \KeywordTok{as.numeric}\NormalTok{(Suspect.database}\OperatorTok{$}\StringTok{`}\DataTypeTok{Q1, m/z}\StringTok{`}\NormalTok{[i]),}
                                            \KeywordTok{as.numeric}\NormalTok{(Suspect.database}\OperatorTok{$}\StringTok{`}\DataTypeTok{Ratio Q2/Q1}\StringTok{`}\NormalTok{[i]),}
                                            \KeywordTok{as.numeric}\NormalTok{(Suspect.database}\OperatorTok{$}\NormalTok{Polarity[i]),}
                                            \KeywordTok{Spectra.find}\NormalTok{(MS1.data,Suspect.database}\OperatorTok{$}\StringTok{`}\DataTypeTok{Q1, m/z}\StringTok{`}\NormalTok{[i],}
\NormalTok{                                                         Suspect.database}\OperatorTok{$}\StringTok{`}\DataTypeTok{Q2, m/z}\StringTok{`}\NormalTok{[i],}
\NormalTok{                                                         Suspect.database}\OperatorTok{$}\StringTok{`}\DataTypeTok{Ratio Q2/Q1}\StringTok{`}\NormalTok{[i],}
                                                         \DataTypeTok{Mass.error.threshold =} \FloatTok{1.25}\NormalTok{)))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Filtering compliant matches for further MS2
analysis}\label{filtering-compliant-matches-for-further-ms2-analysis}

Convert numbers to the correct format (numeric).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  Results.suspect[,}\DecValTok{3}\OperatorTok{:}\DecValTok{11}\NormalTok{] <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(Results.suspect[,}\DecValTok{3}\OperatorTok{:}\DecValTok{11}\NormalTok{,}\DataTypeTok{drop=}\OtherTok{FALSE}\NormalTok{],as.numeric)}
\NormalTok{  Results.target[,}\DecValTok{3}\OperatorTok{:}\DecValTok{11}\NormalTok{] <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(Results.target[,}\DecValTok{3}\OperatorTok{:}\DecValTok{11}\NormalTok{,}\DataTypeTok{drop=}\OtherTok{FALSE}\NormalTok{],as.numeric)}
\end{Highlighting}
\end{Shaded}

Define the number of MS2 spectra that will be acquired per compound.
\textbf{Change} the value if the number of MS2 spectra per compound is
not 3!

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  No.MS2.spectra <-}\StringTok{ }\DecValTok{3}
\end{Highlighting}
\end{Shaded}

Create a list of MS2 spectra filenames (CSV) for target screening.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Target.MSMS.list <-}\StringTok{ }\NormalTok{Results.target }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Max.ratio.error =} \DecValTok{20}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Max.ratio.error =} \KeywordTok{ifelse}\NormalTok{(Ratio.theoretical }\OperatorTok{>}\StringTok{ }\DecValTok{50}\NormalTok{, }\DecValTok{20}\NormalTok{,}
                                    \KeywordTok{ifelse}\NormalTok{(Ratio.theoretical }\OperatorTok{>}\StringTok{ }\DecValTok{20}\NormalTok{, }\DecValTok{25}\NormalTok{,}
                                           \KeywordTok{ifelse}\NormalTok{(Ratio.theoretical }\OperatorTok{>}\StringTok{ }\DecValTok{10}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{50}\NormalTok{)))) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{((Ratio.error.rel }\OperatorTok{<}\StringTok{ }\NormalTok{Max.ratio.error) }\OperatorTok{&}\StringTok{ }\NormalTok{(Ratio.error.rel }\OperatorTok{>}\StringTok{ }\OperatorTok{-}\NormalTok{Max.ratio.error)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{((Error.Q1 }\OperatorTok{<}\StringTok{ }\FloatTok{1.25}\NormalTok{) }\OperatorTok{&}\StringTok{ }\NormalTok{(Error.Q2 }\OperatorTok{>}\StringTok{ }\OperatorTok{-}\FloatTok{1.25}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{select}\NormalTok{(Name, Q1, Charge) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{slice}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{n}\NormalTok{(), }\DataTypeTok{each=}\NormalTok{No.MS2.spectra)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{File.name =} \KeywordTok{paste}\NormalTok{(}\KeywordTok{row_number}\NormalTok{(),}\StringTok{"-"}\NormalTok{,}\KeywordTok{ifelse}\NormalTok{(Charge }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{,}\StringTok{"POS"}\NormalTok{,}\StringTok{"NEG"}\NormalTok{),}\StringTok{".csv"}\NormalTok{, }\DataTypeTok{sep =} \StringTok{""}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Create a list of MS2 spectra filenames (CSV) for suspect screening.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Suspect.MSMS.list <-}\StringTok{ }\NormalTok{Results.suspect }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Max.ratio.error =} \DecValTok{20}\NormalTok{) }\OperatorTok{%>%}
\CommentTok{#  mutate(Max.ratio.error = ifelse(Ratio.theoretical > 50, 20,                            #' Delete "#" to make Q2/Q1 ratio thershold in accordance to 2002/657/EC }
\CommentTok{#                                  ifelse(Ratio.theoretical > 20, 25,                     #' Delete "#" to make Q2/Q1 ratio thershold in accordance to 2002/657/EC  }
\CommentTok{#                                         ifelse(Ratio.theoretical > 10, 30, 50)))) %>%   #' Delete "#" to make Q2/Q1 ratio thershold in accordance to 2002/657/EC  }
\StringTok{  }\KeywordTok{filter}\NormalTok{((Ratio.error.rel }\OperatorTok{<}\StringTok{ }\NormalTok{Max.ratio.error) }\OperatorTok{&}\StringTok{ }\NormalTok{(Ratio.error.rel }\OperatorTok{>}\StringTok{ }\OperatorTok{-}\NormalTok{Max.ratio.error)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{((Error.Q1 }\OperatorTok{<}\StringTok{ }\FloatTok{1.25}\NormalTok{) }\OperatorTok{&}\StringTok{ }\NormalTok{(Error.Q2 }\OperatorTok{>}\StringTok{ }\OperatorTok{-}\FloatTok{1.25}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(Name, Q1, Charge) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{slice}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{n}\NormalTok{(), }\DataTypeTok{each=}\NormalTok{No.MS2.spectra)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{File.name =} \KeywordTok{paste}\NormalTok{(}\KeywordTok{row_number}\NormalTok{(),}\StringTok{"-"}\NormalTok{,}\KeywordTok{ifelse}\NormalTok{(Charge }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{,}\StringTok{"POS"}\NormalTok{,}\StringTok{"NEG"}\NormalTok{),}\StringTok{".csv"}\NormalTok{, }\DataTypeTok{sep =} \StringTok{""}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Assign collision energy (CE) levels for MS2 measurements.

If \textbf{No.MS2.spectra} == 1 then only one level is defined!

If \textbf{No.MS2.spectra} \textgreater{} 1 then set CE levels manually
by writing them under \textbf{CE.levels} variable! 2 levels: CE.levels
\textless{}- c(``1st CE level'', ``2nd CE level'')

3 levels: CE.levels \textless{}- c(``1st CE level'', ``2nd CE level'',
``3rd CE level'')

4 levels: CE.levels \textless{}- c(``1st CE level'', ``2nd CE level'',
``3rd CE level'', ``4th level'')

etc.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{CE.levels <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"1st CE level"}\NormalTok{, }\StringTok{"2nd CE level"}\NormalTok{, }\StringTok{"3rd CE level"}\NormalTok{)}

\ControlFlowTok{if}\NormalTok{ (No.MS2.spectra }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) \{}
\NormalTok{  Target.MSMS.list}\OperatorTok{$}\NormalTok{CE.level <-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(}\StringTok{"your CE level"}\NormalTok{) }
\NormalTok{  Suspect.MSMS.list}\OperatorTok{$}\NormalTok{CE.level <-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(}\StringTok{"your CE level"}\NormalTok{) }
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{  Target.MSMS.list}\OperatorTok{$}\NormalTok{CE.level <-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{) }
\NormalTok{  Suspect.MSMS.list}\OperatorTok{$}\NormalTok{CE.level <-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{)}
  
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{dim}\NormalTok{(Target.MSMS.list)[}\DecValTok{1}\NormalTok{]) \{}
\NormalTok{    Target.MSMS.list}\OperatorTok{$}\NormalTok{CE.level[i] <-}\StringTok{ }\NormalTok{CE.levels[}\KeywordTok{c}\NormalTok{(No.MS2.spectra, }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\NormalTok{(No.MS2.spectra}\OperatorTok{-}\DecValTok{1}\NormalTok{)))[(i}\OperatorTok{%%}\NormalTok{No.MS2.spectra)}\OperatorTok{+}\DecValTok{1}\NormalTok{]]}
\NormalTok{  \}}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{dim}\NormalTok{(Suspect.MSMS.list)[}\DecValTok{1}\NormalTok{]) \{}
\NormalTok{    Suspect.MSMS.list}\OperatorTok{$}\NormalTok{CE.level[i] <-}\StringTok{ }\NormalTok{CE.levels[}\KeywordTok{c}\NormalTok{(No.MS2.spectra, }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\NormalTok{(No.MS2.spectra}\OperatorTok{-}\DecValTok{1}\NormalTok{)))[(i}\OperatorTok{%%}\NormalTok{No.MS2.spectra)}\OperatorTok{+}\DecValTok{1}\NormalTok{]]}
\NormalTok{  \}\}}
\end{Highlighting}
\end{Shaded}

Check both MS2 filename lists:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(Target.MSMS.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           Name       Q1 Charge File.name     CE.level
## 1 Atorvastatin 559.2603      1 1-POS.csv 1st CE level
## 2 Atorvastatin 559.2603      1 2-POS.csv 2nd CE level
## 3 Atorvastatin 559.2603      1 3-POS.csv 3rd CE level
## 4   Diclofenac 294.0094     -1 4-NEG.csv 1st CE level
## 5   Diclofenac 294.0094     -1 5-NEG.csv 2nd CE level
## 6   Diclofenac 294.0094     -1 6-NEG.csv 3rd CE level
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(Suspect.MSMS.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           Name       Q1 Charge File.name     CE.level
## 1   Alprazolam 309.0902      1 1-POS.csv 1st CE level
## 2   Alprazolam 309.0902      1 2-POS.csv 2nd CE level
## 3   Alprazolam 309.0902      1 3-POS.csv 3rd CE level
## 4 Atorvastatin 559.2603      1 4-POS.csv 1st CE level
## 5 Atorvastatin 559.2603      1 5-POS.csv 2nd CE level
## 6 Atorvastatin 559.2603      1 6-POS.csv 3rd CE level
\end{verbatim}

Write precursor mass lists to a file

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{write.table}\NormalTok{(Target.MSMS.list,}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/Precursor lists/"}\NormalTok{,Sample.name,}\StringTok{"-Precursor_mass_list_target.xls"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{""}\NormalTok{),}\DataTypeTok{sep =} \StringTok{"}\CharTok{\textbackslash{}t}\StringTok{"}\NormalTok{,}\DataTypeTok{row.names =} \OtherTok{FALSE}\NormalTok{)}
\KeywordTok{write.table}\NormalTok{(Suspect.MSMS.list,}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/Precursor lists/"}\NormalTok{,Sample.name,}\StringTok{"-Precursor_mass_list_suspect.xls"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{""}\NormalTok{),}\DataTypeTok{sep =} \StringTok{"}\CharTok{\textbackslash{}t}\StringTok{"}\NormalTok{,}\DataTypeTok{row.names =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Sample measurement (MS2
analysis)}\label{sample-measurement-ms2-analysis}

Measure the sample to obtain MS2 spectra that correspond to the
generated lists: \textbf{Target.MSMS.list} and
\textbf{Suspect.MSMS.list}

Each analyte has to be measured \textbf{No.MS2.spectra} times! In this
example \textbf{No.MS2.spectra} is 3 and the measurements are done in
three collision energy levels (low, medium and high).

Export the spectra as CSV files. Name the CSV files in accordance to
generated lists (\textbf{Target.MSMS.list} and
\textbf{Suspect.MSMS.list}).

Store target MS2 spectra in the main directory under
\textasciitilde{}/Samples/Sample\_name/MS2\_spectra\_target/

Store suspect MS2 spectra in the main directory under
\textasciitilde{}/Samples/Sample\_name/MS2\_spectra\_suspect/

\emph{CSV files of MS2 spectra have to contain two columns (m/z values
and m/z signal intensities)}

\begin{longtable}[]{@{}ll@{}}
\toprule
Column 1 (m/z) & Column 2 (signal intensity, counts)\tabularnewline
\midrule
\endhead
294.0068 & 121821\tabularnewline
296.0063 & 29324\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{MS2 data processing (target analysis; with experimental
library
spectra)}\label{ms2-data-processing-target-analysis-with-experimental-library-spectra}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Results.target <-}\StringTok{ }\KeywordTok{Consolidate_MS2_results}\NormalTok{(}\KeywordTok{MS2.screener}\NormalTok{(}\DataTypeTok{Precursor.list =}\NormalTok{  Target.MSMS.list,}
                                                       \DataTypeTok{MS2.peaklist =}\NormalTok{ Target.database,}
                                                       \DataTypeTok{Sample.name =}\NormalTok{ Sample.name,}
                                                       \DataTypeTok{Type =} \StringTok{"Target"}\NormalTok{,}
                                                       \DataTypeTok{MS2.ref.spectra.type =} \StringTok{"Experimental"}\NormalTok{,}
                                                       \DataTypeTok{Template =} \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{Name =} \KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                                                                             \DataTypeTok{Polarity =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                                                                             \DataTypeTok{Fragment =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                                                                             \DataTypeTok{Status.found =} \KeywordTok{as.logical}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                                                                             \DataTypeTok{CE.level =} \KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{),                         }
                                                                             \DataTypeTok{File.name =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{stringsAsFactors =} \OtherTok{FALSE}\NormalTok{)),}\DataTypeTok{Storage_sheet =}\NormalTok{ Results.target)}
\end{Highlighting}
\end{Shaded}

Check target results:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Results.target }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(MS2.Status }\OperatorTok{==}\StringTok{ }\OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{head}\NormalTok{(.)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           Name MolecularFormula       Q1 Ratio.theoretical Charge
## 1 Atorvastatin      C33H35FN2O5 559.2603          36.38933      1
## 2   Diclofenac     C14H11Cl2NO2 294.0094          64.42621     -1
## 3    Ibuprofen         C13H18O2 205.1234          14.13700     -1
##   Intensity Error.Q1 Error.Q2 Ratio.experimental Ratio.error.rel
## 1     10000     0.55    -0.78              31.32          -13.93
## 2     10000     1.08    -0.44              59.11           -8.25
## 3     10000     0.91     0.98              12.98           -8.18
##   Ratio.error.abs MS2.found MS2.CE.level MS2.fragments.in.db MS2.Status
## 1           -5.07         3 3rd CE level                   3       TRUE
## 2           -5.32         2 1st CE level                   3       TRUE
## 3           -1.16         1 1st CE level                   1       TRUE
\end{verbatim}

Write target results to a file.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{write.table}\NormalTok{(Results.target[}\OperatorTok{-}\DecValTok{1}\NormalTok{,],}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/Results/"}\NormalTok{,Sample.name,}\StringTok{"-Target_results.xls"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{""}\NormalTok{),}\DataTypeTok{sep =} \StringTok{"}\CharTok{\textbackslash{}t}\StringTok{"}\NormalTok{,}\DataTypeTok{row.names =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{MS2 data processing (suspect screeining; with experimental
library
spectra)}\label{ms2-data-processing-suspect-screeining-with-experimental-library-spectra}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Results.suspect <-}\StringTok{ }\KeywordTok{Consolidate_MS2_results}\NormalTok{(}\KeywordTok{MS2.screener}\NormalTok{(}\DataTypeTok{Precursor.list =}\NormalTok{  Suspect.MSMS.list,}
                                                       \DataTypeTok{MS2.peaklist =}\NormalTok{ Suspect.database,}
                                                       \DataTypeTok{Sample.name =}\NormalTok{ Sample.name,}
                                                       \DataTypeTok{Type =} \StringTok{"Suspect"}\NormalTok{,}
                                                       \DataTypeTok{MS2.ref.spectra.type =} \StringTok{"Experimental"}\NormalTok{,}
                                                       \DataTypeTok{Template =} \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{Name =} \KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                                                                             \DataTypeTok{Polarity =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                                                                             \DataTypeTok{Fragment =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                                                                             \DataTypeTok{Status.found =} \KeywordTok{as.logical}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                                                                             \DataTypeTok{CE.level =} \KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{),                         }
                                                                             \DataTypeTok{File.name =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{stringsAsFactors =} \OtherTok{FALSE}\NormalTok{)),}\DataTypeTok{Storage_sheet =}\NormalTok{ Results.suspect)}
\end{Highlighting}
\end{Shaded}

Check target results:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Results.suspect }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(MS2.Status }\OperatorTok{==}\StringTok{ }\OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{head}\NormalTok{(.)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                Name MolecularFormula       Q1 Ratio.theoretical Charge
## 1        Alprazolam       C17H13ClN4 309.0902          32.20218      1
## 2       Venlafaxine        C17H27NO2 278.2115          18.45302      1
## 3        Diclofenac     C14H11Cl2NO2 294.0094          64.42621     -1
## 4 Meclofenamic acid     C14H11Cl2NO2 294.0094          64.42621     -1
## 5         Ibuprofen         C13H18O2 205.1234          14.13700     -1
##   Intensity Error.Q1 Error.Q2 Ratio.experimental Ratio.error.rel
## 1     10000    -0.64    -0.93              28.71          -10.84
## 2     10000     1.13    -0.68              16.12          -12.64
## 3     10000     1.08    -0.44              59.11           -8.25
## 4     10000     1.08    -0.44              59.11           -8.25
## 5     10000     0.91     0.98              12.98           -8.18
##   Ratio.error.abs MS2.found MS2.CE.level MS2.fragments.in.db MS2.Status
## 1           -3.49         4 3rd CE level                   4       TRUE
## 2           -2.33         5 1st CE level                   5       TRUE
## 3           -5.32         2 1st CE level                   3       TRUE
## 4           -5.32         1 2nd CE level                   2       TRUE
## 5           -1.16         1 1st CE level                   1       TRUE
\end{verbatim}

Write target results to a file

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{write.table}\NormalTok{(Results.suspect[}\OperatorTok{-}\DecValTok{1}\NormalTok{,],}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/Results/"}\NormalTok{,Sample.name,}\StringTok{"-Suspect_results_exp_MS2.xls"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{""}\NormalTok{),}\DataTypeTok{sep =} \StringTok{"}\CharTok{\textbackslash{}t}\StringTok{"}\NormalTok{,}\DataTypeTok{row.names =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{MS2 data processing (suspect screeining; with in-silico
libray
spectra)}\label{ms2-data-processing-suspect-screeining-with-in-silico-libray-spectra}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Results.suspect.in.silico <-}\StringTok{ }\KeywordTok{Consolidate_MS2_results}\NormalTok{(}\KeywordTok{MS2.screener}\NormalTok{(}\DataTypeTok{Precursor.list =}\NormalTok{  Suspect.MSMS.list,}
                                                        \DataTypeTok{MS2.peaklist =}\NormalTok{ Suspect.database,}
                                                        \DataTypeTok{Sample.name =}\NormalTok{ Sample.name,}
                                                        \DataTypeTok{Type =} \StringTok{"Suspect"}\NormalTok{,}
                                                        \DataTypeTok{MS2.ref.spectra.type =} \StringTok{"In-silico"}\NormalTok{,}
                                                        \DataTypeTok{Template =} \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{Name =} \KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                                                                              \DataTypeTok{Polarity =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                                                                              \DataTypeTok{Fragment =} \KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                                                                              \DataTypeTok{Status.found =} \KeywordTok{as.logical}\NormalTok{(}\OtherTok{NA}\NormalTok{),}
                                                                              \DataTypeTok{CE.level =} \KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{),                         }
                                                                              \DataTypeTok{File.name =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{stringsAsFactors =} \OtherTok{FALSE}\NormalTok{)),}\DataTypeTok{Storage_sheet =}\NormalTok{ Results.suspect)}
\end{Highlighting}
\end{Shaded}

Check target results:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Results.suspect.in.silico }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(MS2.Status }\OperatorTok{==}\StringTok{ }\OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{head}\NormalTok{(.)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                Name MolecularFormula       Q1 Ratio.theoretical Charge
## 1       Venlafaxine        C17H27NO2 278.2115          18.45302      1
## 2        Diclofenac     C14H11Cl2NO2 294.0094          64.42621     -1
## 3 Meclofenamic acid     C14H11Cl2NO2 294.0094          64.42621     -1
##   Intensity Error.Q1 Error.Q2 Ratio.experimental Ratio.error.rel
## 1     10000     1.13    -0.68              16.12          -12.64
## 2     10000     1.08    -0.44              59.11           -8.25
## 3     10000     1.08    -0.44              59.11           -8.25
##   Ratio.error.abs MS2.found MS2.CE.level MS2.fragments.in.db MS2.Status
## 1           -2.33         2 1st CE level                   5       TRUE
## 2           -5.32         1 1st CE level                   5       TRUE
## 3           -5.32         1 1st CE level                   5       TRUE
\end{verbatim}

Write target results to a file.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{write.table}\NormalTok{(Results.suspect.in.silico[}\OperatorTok{-}\DecValTok{1}\NormalTok{,],}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Samples/"}\NormalTok{,Sample.name,}\StringTok{"/Results/"}\NormalTok{,Sample.name,}\StringTok{"-Suspect_results_in-silico_MS2.xls"}\NormalTok{,}\DataTypeTok{sep =} \StringTok{""}\NormalTok{),}\DataTypeTok{sep =} \StringTok{"}\CharTok{\textbackslash{}t}\StringTok{"}\NormalTok{,}\DataTypeTok{row.names =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}


\end{document}
